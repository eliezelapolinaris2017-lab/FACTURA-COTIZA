<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>FACTURA-COTIZA</title>
  <link rel="stylesheet" href="./styles.css" />
</head>
<body>
  <div class="app-shell">
    <!-- Sidebar -->
    <aside id="sidebar" class="sidebar">
      <div class="brand">
        <img id="brandLogo" src="assets/logo-placeholder.png" alt="Logo" />
        <h2>FACTURA-COTIZA</h2>
      </div>

      <nav class="nav">
        <button class="navlink active" data-nav="nuevo">üßæ Nuevo</button>
        <button class="navlink" data-nav="historial">üìö Historial</button>
        <button class="navlink" data-nav="config">‚öôÔ∏è Configuraci√≥n</button>
      </nav>

      <footer class="auth-box">
        <div class="auth-info">
          <p><b>Estado:</b> <span id="authState">Sin sesi√≥n</span></p>
          <p><b>UID:</b> <span id="uid">‚Äî</span></p>
        </div>
        <button id="btnLogin" class="btn btn-gold">üîë Iniciar sesi√≥n con Google</button>
        <button id="btnLogout" class="btn btn-dark" style="display:none">üö™ Cerrar sesi√≥n</button>
      </footer>
    </aside>

    <!-- Main -->
    <main class="main">
      <header class="topbar">
        <button id="btnToggle" class="hamburger" aria-label="Mostrar/ocultar men√∫">‚ò∞</button>
        <h1>FACTURA-COTIZA</h1>
      </header>

      <!-- NUEVO -->
      <section id="view-nuevo" class="view visible">
        <h2>üßæ Nueva Factura o Cotizaci√≥n</h2>

        <form id="formDoc" class="card">
          <div class="grid">
            <label>N√∫mero (opcional)
              <input id="docNumber" placeholder="Ej: FAC-2 o COT-5">
            </label>
            <label>Tipo
              <select id="docType">
                <option value="FAC">Factura</option>
                <option value="COT">Cotizaci√≥n</option>
              </select>
            </label>
            <label>Fecha
              <input type="date" id="docDate" required>
            </label>
            <label>Cliente (nombre)
              <input type="text" id="clientName" required placeholder="Nombre o empresa">
            </label>
            <label>Cliente (tel√©fono)
              <input type="tel" id="clientPhone" placeholder="787-555-5555" inputmode="tel">
            </label>
            <label>M√©todo de pago
              <select id="docPay">
                <option>ATH M√≥vil</option>
                <option>Tarjeta</option>
                <option>Efectivo</option>
                <option>Cheque</option>
                <option>PayPal</option>
                <option>Otros</option>
              </select>
            </label>
            <label>Notas
              <input type="text" id="docNotes" placeholder="Condiciones, garant√≠as, etc.">
            </label>
          </div>

          <h3>Servicios / √çtems</h3>
          <div class="tablewrap">
            <table class="table" id="tblItems">
              <thead>
                <tr>
                  <th>√çtem</th>
                  <th>Descripci√≥n</th>
                  <th style="width:10ch">Precio</th>
                  <th style="width:10ch">Cant.</th>
                  <th style="width:12ch" class="right">Importe</th>
                  <th style="width:6ch"></th>
                </tr>
              </thead>
              <tbody id="linesBody"></tbody>
            </table>
          </div>
          <button type="button" id="btnAddLine" class="btn">‚ûï A√±adir l√≠nea</button>

          <div class="totals">
            <label>Descuento %
              <input id="tDiscPct" type="number" step="0.01" inputmode="decimal" value="0">
            </label>
            <label>IVU %
              <input id="tTaxPct" type="number" step="0.01" inputmode="decimal" value="0">
            </label>
            <div><span>Subtotal</span><b id="tSubtotal">$0.00</b></div>
            <div><span>Descuento</span><b id="tDiscAmt">$0.00</b></div>
            <div><span>Impuesto</span><b id="tTaxAmt">$0.00</b></div>
            <div class="total"><span>Total</span><b id="tTotal">$0.00</b></div>
          </div>

          <div class="toolbar end">
            <button type="button" id="btnPrint" class="btn">üìÑ PDF</button>
            <button type="submit" class="btn btn-gold">üíæ Guardar</button>
          </div>
        </form>
      </section>

      <!-- HISTORIAL -->
      <section id="view-historial" class="view">
        <h2>üìö Historial</h2>
        <div class="toolbar">
          <button id="btnReload" class="btn">üîÑ Recargar</button>
          <button id="btnCsv" class="btn btn-gold">üì§ Exportar CSV</button>
          <button id="btnBackup" class="btn btn-gold">üíæ Backup JSON</button>
          <label class="btn btn-dark" for="fileRestore" style="cursor:pointer">üìÇ Restaurar</label>
          <input type="file" id="fileRestore" accept="application/json" style="display:none">
        </div>
        <div id="listDocs" class="list"></div>
      </section>

      <!-- CONFIGURACI√ìN -->
      <section id="view-config" class="view">
        <h2>‚öôÔ∏è Configuraci√≥n del negocio</h2>
        <form id="formCfg" class="card">
          <div class="grid">
            <label>Nombre de la empresa
              <input type="text" id="cfgName" required>
            </label>
            <label>Tel√©fono
              <input type="tel" id="cfgPhone" required inputmode="tel">
            </label>
            <label>Logo para FACTURA (FAC)
              <input type="file" id="cfgLogoFAC" accept="image/*">
            </label>
            <label>Logo para COTIZACI√ìN (COT)
              <input type="file" id="cfgLogoCOT" accept="image/*">
            </label>
          </div>
          <div class="logos">
            <div>
              <p>Vista FAC</p>
              <img id="prevFAC" class="preview" alt="Logo FAC" />
            </div>
            <div>
              <p>Vista COT</p>
              <img id="prevCOT" class="preview" alt="Logo COT" />
            </div>
          </div>
          <div class="toolbar end">
            <!-- NUEVO: bot√≥n de sincronizaci√≥n -->
            <button type="button" id="btnSync" class="btn">üîÅ Sincronizar con Firebase</button>
            <button type="submit" class="btn btn-gold">üíæ Guardar configuraci√≥n</button>
          </div>
          <!-- NUEVO: sello de hora -->
          <p class="muted" id="syncStamp" style="margin-top:6px">‚Äî</p>
        </form>
      </section>
    </main>
  </div>

  <!-- ====== PLANTILLA PDF (A4, formato ejemplo) ====== -->
  <section id="printArea">
    <div class="sheet" id="pdfSheet">
      <header class="pdf-head">
        <div class="pdf-meta">
          <h2 id="pDocTitle">Factura</h2>
          <p><b>N√∫mero:</b> <span id="pNumber">‚Äî</span></p>
          <p><b>Fecha:</b> <span id="pDate">‚Äî</span></p>
          <p><b>Cliente:</b> <span id="pClientName">‚Äî</span></p>
          <p><b>Pago:</b> <span id="pPay">‚Äî</span></p>
          <p><b>Estado:</b> <span id="pStatus">final</span></p>
        </div>
        <div class="pdf-brand">
          <img id="pLogo" class="pdf-logo" alt="">
          <div class="pdf-biz">
            <h3 id="pBizName">Nombre del Negocio</h3>
            <div id="pBizPhone" class="muted">Tel: ‚Äî</div>
          </div>
        </div>
      </header>

      <table class="pdf-items" id="pTable">
        <thead>
          <tr>
            <th class="c-item">√çtem</th>
            <th class="c-detalle">Detalle</th>
            <th class="c-precio right">Precio</th>
            <th class="c-cant right">Cant.</th>
            <th class="c-importe right">Importe</th>
          </tr>
        </thead>
        <tbody id="pLines"></tbody>
      </table>

      <section class="pdf-totals">
        <table>
          <tbody>
            <tr><td>Subtotal</td><td class="right" id="pSubtotal">$0.00</td></tr>
            <tr><td id="pDiscLbl">Descuento (0%)</td><td class="right" id="pDiscAmt">$0.00</td></tr>
            <tr><td id="pTaxLbl">IVU (0%)</td><td class="right" id="pTaxAmt">$0.00</td></tr>
            <tr class="total"><td>Total</td><td class="right" id="pTotal">$0.00</td></tr>
          </tbody>
        </table>
      </section>

      <section class="pdf-notes">
        <p><b>Notas:</b></p>
        <p id="pNotes">‚Äî</p>
      </section>

      <footer class="pdf-foot">
        <div>https://eliezelapolinaris2017-lab.github.io/FACTURA-COTIZA/</div>
        <div><span id="pGen">‚Äî</span> ¬∑ P√°gina <span class="pageNumber"></span> de <span class="totalPages"></span></div>
      </footer>
    </div>
  </section>

  <script type="module" src="./firebase-init.js"></script>
  <script type="module" src="./app.js"></script>
</body>
</html>
