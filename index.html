<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>FACTURA-COTIZA</title>
  <link rel="icon" href="favicon.png">
  <link rel="stylesheet" href="styles.css">
  <script type="module" src="firebase-init.js"></script>
  <script type="module" src="app.js"></script>
</head>
<body>

  <!-- Sidebar estilo ‚ÄúSalonPro‚Äù -->
  <aside class="sidebar">
    <div class="brand">
      <div class="brand-logo">üßæ</div>
      <div class="brand-info">
        <h1>FACTURA-COTIZA</h1>
        <small id="bizTagline">Gesti√≥n elegante</small>
      </div>
    </div>

    <nav class="menu">
      <button class="menu-item active" data-go="page-nuevo">üßæ Nuevo</button>
      <button class="menu-item" data-go="page-historial">üìö Historial</button>
      <button class="menu-item" data-go="page-config">‚öôÔ∏è Configuraci√≥n</button>
    </nav>

    <div class="authbox">
      <div class="auth-state"><b>Estado:</b> <span id="authState">Sin sesi√≥n</span></div>
      <div class="uid"><b>UID:</b> <span id="uid">‚Äî</span></div>
      <div class="auth-actions">
        <button id="btnLogin" class="btn btn-gold">üîë Iniciar sesi√≥n</button>
        <button id="btnLogout" class="btn btn-dark" style="display:none">üö™ Cerrar sesi√≥n</button>
      </div>
    </div>
  </aside>

  <!-- Contenido principal -->
  <main class="content">

    <!-- NUEVO DOCUMENTO -->
    <section id="page-nuevo" class="page visible">
      <header class="page-header">
        <h2>Nuevo documento</h2>
        <div class="header-actions">
          <button id="btnSave" class="btn btn-gold">üíæ Guardar</button>
          <button id="btnPrint" class="btn btn-outline">üñ®Ô∏è Imprimir / PDF</button>
        </div>
      </header>

      <!-- Datos de documento -->
      <div class="card">
        <div class="grid g-4">
          <label>Tipo
            <select id="docType">
              <option value="FAC">Factura</option>
              <option value="COT">Cotizaci√≥n</option>
            </select>
          </label>
          <label>Fecha
            <input id="docDate" type="date"/>
          </label>
          <label>M√©todo de pago
            <select id="docPay">
              <option>ATH</option>
              <option>ATH M√≥vil</option>
              <option>Cheque</option>
              <option>Efectivo</option>
              <option>PayPal</option>
            </select>
          </label>
          <label>N√∫mero (opcional)
            <input id="docNumber" placeholder="autonum si lo dejas vac√≠o">
          </label>
        </div>
      </div>

      <!-- Datos de negocio y cliente r√°pidos (negocio viene de Config) -->
      <div class="grid g-2">
        <div class="card">
          <h3>Negocio</h3>
          <div id="bizPreview">
            <div class="biz-logo-wrap">
              <img id="logoPreview" alt="logo" />
            </div>
            <div>
              <div><b id="bizNamePreview">‚Äî</b></div>
              <div id="bizPhonePreview">‚Äî</div>
            </div>
          </div>
        </div>
        <div class="card">
          <h3>Cliente</h3>
          <div class="grid g-2">
            <label>Nombre del cliente
              <input id="clientName" placeholder="Nombre o empresa"/>
            </label>
            <label>Tel√©fono del cliente
              <input id="clientPhone" inputmode="tel" placeholder="(787) 000-0000"/>
            </label>
          </div>
          <label>Notas
            <textarea id="docNotes" rows="2" placeholder="Condiciones, mensajes, etc."></textarea>
          </label>
        </div>
      </div>

      <!-- L√≠neas -->
      <div class="card">
        <div class="lines-head">
          <h3>Servicios / √çtems</h3>
          <button id="btnAddLine" class="btn btn-gold">Ôºã A√±adir l√≠nea</button>
        </div>
        <div class="table-wrap">
          <table class="lines" id="linesTable" aria-label="L√≠neas">
            <thead>
              <tr>
                <th style="width:22%">√çtem</th>
                <th>Descripci√≥n</th>
                <th style="width:12%">Precio</th>
                <th style="width:12%">Cant.</th>
                <th style="width:14%">Importe</th>
                <th style="width:8%"></th>
              </tr>
            </thead>
            <tbody id="linesBody"></tbody>
          </table>
        </div>

        <div class="totals">
          <div class="totals-row"><span>Subtotal</span><span id="subTotal">$0.00</span></div>
          <div class="totals-row">
            <span>Descuento (%)</span>
            <input id="discPct" type="number" step="0.01" inputmode="decimal" value="0">
          </div>
          <div class="totals-row">
            <span>Impuesto (%)</span>
            <input id="taxPct" type="number" step="0.01" inputmode="decimal" value="11.5">
          </div>
          <div class="totals-row grand">
            <span>Total</span><span id="grandTotal">$0.00</span>
          </div>
        </div>
      </div>
    </section>

    <!-- HISTORIAL -->
    <section id="page-historial" class="page">
      <header class="page-header">
        <h2>Historial</h2>
        <div class="header-actions">
          <button id="btnReload" class="btn btn-outline">üîÑ Recargar</button>
          <button id="btnCsv" class="btn btn-gold">üì§ Exportar CSV</button>
        </div>
      </header>

      <div id="historyList" class="list"></div>
    </section>

    <!-- CONFIGURACI√ìN -->
    <section id="page-config" class="page">
      <header class="page-header">
        <h2>Configuraci√≥n</h2>
        <div class="header-actions">
          <button id="btnSaveConfig" class="btn btn-gold">üíæ Guardar Configuraci√≥n</button>
        </div>
      </header>

      <div class="card">
        <h3>Datos del negocio</h3>
        <div class="grid g-3">
          <label>Nombre de la empresa
            <input id="bizName" placeholder="Mi Empresa LLC" required>
          </label>
          <label>Tel√©fono
            <input id="bizPhone" inputmode="tel" placeholder="(787) 000-0000">
          </label>
          <label>Moneda
            <input id="bizCurrency" value="USD">
          </label>
        </div>
      </div>

      <div class="grid g-2">
        <div class="card">
          <h3>Logo para Factura (FAC)</h3>
          <div class="logo-uploader">
            <input id="logoFAC" type="file" accept="image/png,image/jpeg">
            <img id="logoFACPrev" alt="logo FAC"/>
          </div>
        </div>
        <div class="card">
          <h3>Logo para Cotizaci√≥n (COT)</h3>
          <div class="logo-uploader">
            <input id="logoCOT" type="file" accept="image/png,image/jpeg">
            <img id="logoCOTPrev" alt="logo COT"/>
          </div>
        </div>
      </div>
    </section>

  </main>

  <!-- PLANTILLA DE IMPRESI√ìN (s√≥lo visible en @media print) -->
  <div id="printArea" aria-hidden="true">
    <div class="print-sheet">
      <header class="print-header">
        <div class="ph-left">
          <img id="printLogo" alt="logo"/>
          <div>
            <h1 id="printBizName">‚Äî</h1>
            <div id="printBizPhone">‚Äî</div>
          </div>
        </div>
        <div class="ph-right">
          <div class="doctype" id="printDocType">‚Äî</div>
          <div><b>N√∫mero:</b> <span id="printDocNumber">‚Äî</span></div>
          <div><b>Fecha:</b> <span id="printDocDate">‚Äî</span></div>
        </div>
      </header>

      <section class="print-party">
        <div><b>Cliente:</b> <span id="printClient">‚Äî</span></div>
        <div><b>Tel√©fono:</b> <span id="printClientPhone">‚Äî</span></div>
        <div><b>Pago:</b> <span id="printPay">‚Äî</span></div>
      </section>

      <table class="print-lines">
        <thead><tr><th>√çtem</th><th>Descripci√≥n</th><th>Precio</th><th>Cant.</th><th>Importe</th></tr></thead>
        <tbody id="printLines"></tbody>
      </table>

      <section class="print-totals">
        <div><span>Subtotal</span><span id="pSub">$0.00</span></div>
        <div><span>Descuento</span><span id="pDisc">$0.00</span></div>
        <div><span>Impuesto</span><span id="pTax">$0.00</span></div>
        <div class="grand"><span>Total</span><span id="pTotal">$0.00</span></div>
      </section>

      <section class="print-notes">
        <b>Notas:</b>
        <div id="printNotes"></div>
      </section>
    </div>
  </div>

</body>
</html>
