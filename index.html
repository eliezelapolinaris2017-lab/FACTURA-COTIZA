<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>FACTURA-COTIZA</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="app-shell">
    <!-- Sidebar -->
    <aside id="sidebar" class="sidebar">
      <div class="brand">
        <img id="brandLogo" src="" alt="Logo" />
        <h2>FACTURA-COTIZA</h2>
      </div>

      <nav class="nav">
        <button class="navlink active" data-nav="nuevo">üßæ Nuevo</button>
        <button class="navlink" data-nav="historial">üìö Historial</button>
        <button class="navlink" data-nav="config">‚öôÔ∏è Configuraci√≥n</button>
      </nav>

      <footer class="auth-box">
        <div class="auth-info">
          <p><b>Estado:</b> <span id="authState">Sin sesi√≥n</span></p>
          <p><b>UID:</b> <span id="uid">‚Äî</span></p>
        </div>
        <button id="btnLogin" class="btn btn-gold">üîë Iniciar sesi√≥n con Google</button>
        <button id="btnLogout" class="btn btn-dark" style="display:none">üö™ Cerrar sesi√≥n</button>
      </footer>
    </aside>

    <!-- Main -->
    <main class="main">
      <header class="topbar">
        <button id="btnToggle" class="hamburger" aria-label="Mostrar/ocultar men√∫">‚ò∞</button>
        <h1>FACTURA-COTIZA</h1>
      </header>

      <!-- NUEVO -->
      <section id="view-nuevo" class="view visible">
        <h2>üßæ Nueva Factura o Cotizaci√≥n</h2>

        <form id="formDoc" class="card">
          <h3>Negocio</h3>
          <div class="grid">
            <label>Nombre del negocio
              <input id="bizName" placeholder="Ej. Oasis Air Cleaner Services LLC" />
            </label>
            <label>Tel√©fono
              <input id="bizPhone" inputmode="tel" placeholder="787-000-0000" />
            </label>
            <label>Logo (opcional)
              <input id="bizLogo" type="file" accept="image/*" />
            </label>
            <div class="logo-preview">
              <img id="bizLogoPreview" alt="Logo" />
            </div>
          </div>

          <h3>Documento</h3>
          <div class="grid">
            <label>Tipo
              <select id="docType">
                <option value="FAC">Factura</option>
                <option value="COT">Cotizaci√≥n</option>
              </select>
            </label>
            <label>N√∫mero
              <input id="docNumber" placeholder="FAC-1 / COT-1" />
            </label>
            <label>Fecha
              <input id="docDate" type="date" />
            </label>
            <label>Cliente
              <input id="clientName" placeholder="Nombre del cliente" />
            </label>
            <label>M√©todo de pago
              <select id="docPay">
                <option>ATH M√≥vil</option>
                <option>Tarjeta</option>
                <option>Efectivo</option>
                <option>Cheque</option>
                <option>PayPal</option>
                <option>Otros</option>
              </select>
            </label>
          </div>

          <h3>Servicios / √çtems</h3>
          <div class="tablewrap">
            <table class="table" id="tbl">
              <thead>
                <tr>
                  <th>Detalle del servicio</th>
                  <th style="width: 11ch" class="right">Costo</th>
                  <th style="width: 6ch"></th>
                </tr>
              </thead>
              <tbody id="lines"></tbody>
            </table>
          </div>
          <button type="button" id="addLine" class="btn">‚ûï A√±adir l√≠nea</button>

          <div class="totals">
            <label>IVU %
              <input id="ivuPct" type="number" step="0.01" inputmode="decimal" value="0" />
            </label>
            <div class="row"><span>Subtotal</span><b id="tSubtotal">$0.00</b></div>
            <div class="row"><span>IVU</span><b id="tIVU">$0.00</b></div>
            <div class="row total"><span>Total</span><b id="tTotal">$0.00</b></div>
          </div>

          <label>Garant√≠a / Notas
            <textarea id="notes" rows="3" placeholder="Garant√≠a de 30 d√≠as en mano de obra."></textarea>
          </label>

          <div class="toolbar end">
            <button type="button" id="btnPdf" class="btn">üìÑ PDF</button>
            <button type="submit" class="btn btn-gold">üíæ Guardar</button>
          </div>
        </form>
      </section>

      <!-- HISTORIAL -->
      <section id="view-historial" class="view">
        <h2>üìö Historial</h2>
        <div class="toolbar">
          <button id="btnReload" class="btn">üîÑ Recargar</button>
          <button id="btnCsv" class="btn btn-gold">üì§ Exportar CSV</button>
          <button id="btnBackup" class="btn btn-gold">üíæ Backup JSON</button>
          <label class="btn btn-dark" for="fileRestore" style="cursor:pointer">üìÇ Restaurar</label>
          <input type="file" id="fileRestore" accept="application/json" style="display:none">
        </div>
        <div id="listDocs" class="list"></div>
      </section>

      <!-- CONFIG -->
      <section id="view-config" class="view">
        <h2>‚öôÔ∏è Configuraci√≥n</h2>
        <form id="formCfg" class="card">
          <div class="grid">
            <label>Nombre del negocio
              <input id="cfgName" />
            </label>
            <label>Tel√©fono
              <input id="cfgPhone" inputmode="tel" />
            </label>
            <label>Logo para FACTURA (FAC)
              <input type="file" id="cfgLogoFAC" accept="image/*">
            </label>
            <label>Logo para COTIZACI√ìN (COT)
              <input type="file" id="cfgLogoCOT" accept="image/*">
            </label>
          </div>
          <div class="logos">
            <div>
              <p>Vista FAC</p>
              <img id="prevFAC" class="preview" alt="Logo FAC" />
            </div>
            <div>
              <p>Vista COT</p>
              <img id="prevCOT" class="preview" alt="Logo COT" />
            </div>
          </div>
          <div class="toolbar end">
            <button type="button" id="btnSync" class="btn sync-btn">üîÅ Sincronizar con Firebase</button>
            <button type="submit" class="btn btn-gold">üíæ Guardar configuraci√≥n</button>
          </div>
          <p class="muted" id="syncStamp" style="margin-top:6px">‚Äî</p>
        </form>
      </section>
    </main>
  </div>

  <!-- ========= PLANTILLA A4 SENCILLA PARA PDF ========= -->
  <section id="printArea">
    <div class="sheet-slim" id="invSheet">
      <header class="inv-head">
        <div class="biz">
          <img id="invLogo" class="logo" alt="Logo" />
          <div>
            <h2 id="invBizName">Nombre del Negocio</h2>
            <div class="muted">Tel: <span id="invBizPhone">‚Äî</span></div>
          </div>
        </div>

        <div class="meta">
          <h3 id="invTitle">Factura</h3>
          <p><b>N√∫mero:</b> <span id="invNumber">FAC-1</span></p>
          <p><b>Fecha:</b> <span id="invDate">‚Äî</span></p>
          <p><b>Cliente:</b> <span id="invClient">‚Äî</span></p>
        </div>
      </header>

      <table class="inv-table">
        <thead>
          <tr>
            <th>Detalle del servicio</th>
            <th class="right" style="width:22mm">Costo</th>
          </tr>
        </thead>
        <tbody id="invLines"></tbody>
      </table>

      <section class="inv-totals">
        <div class="row"><span>Subtotal</span><b id="invSubtotal">$0.00</b></div>
        <div class="row"><span>IVU</span><b id="invTax">$0.00</b></div>
        <div class="row total"><span>Total</span><b id="invTotal">$0.00</b></div>
      </section>

      <section class="inv-notes">
        <p><b>Garant√≠a / Notas:</b></p>
        <p id="invNotes">‚Äî</p>
      </section>
    </div>
  </section>

  <script type="module" src="firebase-init.js"></script>
  <script type="module" src="app.js"></script>
</body>
</html>
